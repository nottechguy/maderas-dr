<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MADERAS DR - Cotizador</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

    <div id="welcome-view" class="welcome-container hidden">
        <div class="welcome-card">
            <h1>Bienvenido al Cotizador</h1>
            <p>Antes de comenzar, necesitamos configurar la información de tu negocio. Este paso solo se realiza una vez.</p>
            <button id="begin-setup-btn">Comenzar Configuración</button>
        </div>
    </div>

    <div id="app-layout" class="app-layout hidden">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img id="sidebar-logo" src="logo.png" alt="Logo del Negocio" style="width:50px; display: none;">
                <h2 id="sidebar-business-name">MADERAS DR</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <!-- ✨ href actualizado -->
                    <li><a href="#cotizador" id="nav-cotizador">Cotizador</a></li>
                    <li class="has-submenu">
                        <a href="#" id="nav-productos-toggle">Productos <span class="arrow">▶</span></a>
                        <ul class="sub-menu">
                            <!-- ✨ href actualizado -->
                            <li><a href="#categorias" id="nav-categories">Categorías</a></li>
                            <!-- ✨ href actualizado -->
                            <li><a href="#productos" id="nav-product-list">Lista de Productos</a></li>
                        </ul>
                    </li>
                    <!-- ✨ href actualizado -->
                    <li><a href="#info" id="nav-info">Información del Negocio</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <p><strong>R.F.C.</strong> <span id="sidebar-rfc"></span></p>
                <p><strong>Tel:</strong> <span id="sidebar-tel"></span></p>
            </div>
        </aside>

        <!-- Scrim -->
        <div id="scrim" class="scrim"></div>

        <!-- Main content -->
        <main class="main-content">
            <button id="menu-toggle" class="menu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>

            <div id="cotizador-view">
                <div class="info-cliente">
                    <h2>Datos del Cliente</h2>
                    <div class="form-grid">
                        <div class="form-group"><label for="cliente-nombre">Nombre:</label><input type="text" id="cliente-nombre" class="cliente-input" required></div>
                        <div class="form-group"><label for="cliente-domicilio">Domicilio:</label><input type="text" id="cliente-domicilio" class="cliente-input"></div>
                        <div class="form-group"><label for="cliente-lugar">Lugar:</label><input type="text" id="cliente-lugar" class="cliente-input"></div>
                        <div class="form-group"><label for="cliente-rfc">R.F.C.:</label><input type="text" id="cliente-rfc" class="cliente-input"></div>
                    </div>
                </div>


                <div id="cotizacion-list-container">
                    <div id="cotizacion-list" class="material-list">
                        </div>
                    <div class="total-container">
                        <div class="iva-toggle">
                            <input type="checkbox" id="iva-checkbox">
                            <label for="iva-checkbox">Agregar IVA (16%)</label>
                        </div>
                        <div id="totals-breakdown" class="totals-breakdown"></div>
                    </div>
                    <div id="total-en-letra" class="total-en-letra-container"></div>
                </div>

                <section class="controles">
                    <div class="form-group select-group">
                        <label for="producto-select">Agregar Producto:</label>
                        <select id="producto-select"></select>
                    </div>
                    <button id="btn-agregar-producto" class="add-button hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    </button>
                    <div class="acciones-finales hidden">
                         <button id="btn-exportar-pdf">Exportar PDF</button>
                         <button id="btn-limpiar-cotizacion">Limpiar</button>
                    </div>
                </section>
            </div>
            
            <!-- ✨ NUEVA VISTA PARA CATEGORÍAS ✨ -->
            <div id="categories-view" class="hidden">
                <div class="category-management">
                    <div class="header-view">
                        <h2>Categorías de Productos</h2>
                    </div>
                    <form id="category-form" class="category-form">
                        <div class="form-group">
                            <label for="new-category-name">Nombre de la Nueva Categoría:</label>
                            <input type="text" id="new-category-name" placeholder="Ej. Madera de Primera" required>
                        </div>
                        <button type="submit" id="btn-add-category">Agregar Categoría</button>
                    </form>
                    <div id="category-list" class="category-list">
                        <!-- Las categorías existentes se mostrarán aquí -->
                    </div>
                </div>
            </div>

            <!-- VISTA DE PRODUCTOS (Rediseñada) -->
            <div id="productos-view" class="hidden">
                <div class="header-view">
                    <h2>Administrar Productos</h2>
                    <!-- Contenedor de Búsqueda Responsivo -->
                    <div class="search-container">
                        <input type="text" id="product-search-input" class="product-search-input" placeholder="Buscar productos...">
                        <button id="product-search-btn" class="product-search-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="filter-chips">
                    <span>Ordenar por:</span>
                    <button class="chip" data-sort="nombre">Nombre</button>
                    <button class="chip" data-sort="categoria">Categoría</button>
                    <button class="chip" data-sort="precio">Precio</button>
                </div>

                <!-- Nueva Lista de Productos -->
                <div id="product-list-container" class="product-list">
                    <!-- Los productos se renderizarán aquí -->
                </div>
            </div>

            
            <div id="info-view" class="hidden">
                <div class="header-view">
                    <h2>Información del Negocio</h2>
                </div>
                <form id="business-info-form" class="info-form">
                    <div class="form-group logo-uploader">
                        <label>Logo del Negocio:</label>
                        <img id="logo-preview" src="" alt="Vista previa del logo" style="display: none;">
                        <input type="file" id="info-logo" accept="image/png, image/jpeg">
                        <label for="info-logo" class="file-label">Seleccionar Archivo</label>
                    </div>
                    <div class="form-grid-info">
                        <div class="form-group"><label for="info-name">Nombre del Negocio:</label><input type="text" id="info-name" required></div>
                        <div class="form-group"><label for="info-description">Descripción/Slogan:</label><input type="text" id="info-description"></div>
                        <div class="form-group"><label for="info-rfc">RFC:</label><input type="text" id="info-rfc"></div>
                        <div class="form-group"><label for="info-calle">Calle y Número:</label><input type="text" id="info-calle"></div>
                        <div class="form-group"><label for="info-colonia">Colonia:</label><input type="text" id="info-colonia"></div>
                        <div class="form-group"><label for="info-cp">Código Postal:</label><input type="text" id="info-cp"></div>
                        <div class="form-group"><label for="info-municipio">Municipio:</label><input type="text" id="info-municipio"></div>
                        <div class="form-group"><label for="info-estado">Estado:</label><input type="text" id="info-estado"></div>
                        <div class="form-group"><label for="info-tel">Teléfono:</label><input type="text" id="info-tel"></div>
                        <div class="form-group"><label for="info-email">Email:</label><input type="email" id="info-email"></div>
                    </div>
                    <div class="form-submit">
                        <button type="submit">Guardar Información</button>
                    </div>
                </form>
            </div>

        </main>
    </div>

    <button id="fab-add-product" class="fab mobile-only fab-hidden">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
    </button>
    
    <dialog id="app-modal" class="app-modal">
        <div id="modal-content">
            <h3 id="modal-title-generic">Título del Modal</h3>
            <p id="modal-message-generic">Este es un mensaje de ejemplo.</p>
            <div id="modal-buttons-generic" class="modal-actions">
                <!-- Los botones se insertarán aquí con JS -->
            </div>
        </div>
    </dialog>

    <!-- ===== MODAL PARA AGREGAR/EDITAR PRODUCTOS (Actualizado) ===== -->
    <dialog id="product-modal">
        <form id="form-producto" method="dialog">
            <h3 id="modal-title">Agregar Producto</h3>
            <input type="hidden" id="producto-id">
            <div class="form-group"><label for="producto-sku">SKU:</label><input type="text" id="producto-sku"></div>
            <div class="form-group"><label for="producto-nombre">Nombre:</label><input type="text" id="producto-nombre" required></div>
            <div class="form-group"><label for="producto-descripcion">Descripción:</label><textarea id="producto-descripcion" rows="2"></textarea></div>
            <div class="form-group"><label for="producto-categoria">Categoría:</label><select id="producto-categoria" required></select></div>
            <div class="form-group"><label for="producto-stock">Stock:</label><input type="number" id="producto-stock" value="0"></div>
            <div class="form-group"><label for="producto-precio">Precio:</label><input type="number" step="0.01" id="producto-precio" required></div>
            <div class="modal-actions">
                <button type="button" id="btn-cancelar-modal">Cancelar</button>
                <button type="submit" id="btn-guardar-producto">Guardar</button>
            </div>
        </form>
    </dialog>

    <script src="db.js"></script>
    <script src="productos-data.js"></script>
    <script src="script.js"></script>
</body>
</html>
